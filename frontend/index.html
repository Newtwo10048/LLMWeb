<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>運動員營養師 AI</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='36' height='36'><rect rx='8' width='36' height='36' fill='%230b6efd'/><text x='50%' y='57%' font-size='18' text-anchor='middle' fill='white' font-family='Arial'>AI</text></svg>" alt="logo"/>
      <h1>運動員營養師 AI</h1>
    </header>

    <!-- 導覽列 -->
    <nav id="mainTabs">
      <button class="tab active" data-panel="loginPanel">登入</button>
      <button class="tab" data-panel="registerPanel">註冊</button>
      <button class="tab" data-panel="profilePanel">個人資訊</button>
      <button class="tab" data-panel="goalsPanel">目標</button>
      <button class="tab" data-panel="dietPanel">飲食紀錄 & 建議</button>
      <button class="tab" data-panel="habitsPanel">運動習慣</button>
      <button class="tab" data-panel="qaPanel">AI 問答</button>
      <button class="tab" data-panel="nutrientPanel">營養素查詢</button>
      <button class="tab" data-panel="foodPanel">食物資料庫</button>
      <button class="tab" data-panel="recipePanel">食譜營養分析</button>
    </nav>

    <section class="panel">

      <div id="loginPanel" class="panelCard">
        <div class="card">
          <h3>登入</h3>
          <form id="loginForm" style="display:flex;gap:8px;align-items:center">
            <input id="loginEmail" placeholder="電子郵件" />
            <input id="loginPass" type="password" placeholder="密碼" />
            <button type="submit">登入</button>
          </form>
          <p id="loginHint" class="muted"></p>
          
          <!-- Google 登入 -->
          <div style="margin-top: 20px; text-align: center;">
            <p style="color: #666; margin-bottom: 10px;">或使用</p>
            <div id="g_id_onload"
              data-client_id="1012981023049-ei8qt2b4qp2n8o0uulpku50tb4cgv4ot.apps.googleusercontent.com"
              data-callback="handleGoogleLogin"
              data-auto_prompt="false">
            </div>
            <div class="g_id_signin" 
              data-type="standard"
              data-shape="rectangular"
              data-theme="outline"
              data-text="signin_with"
              data-size="large"
              data-locale="zh_TW">
            </div>
          </div>
        </div>
      </div>
      <!-- 註冊 -->
      <div id="registerPanel" class="panelCard" style="display:none">
        <div class="register-container">
    <div class="register-header">
      <h1>🏃‍♂️ 建立帳號</h1>
      <p>開始您的運動員營養管理之旅</p>
    </div>

    <form id="registerForm" onsubmit="return false;">
      <div class="form-group">
        <label for="register-email">Email 帳號</label>
        <input 
          type="email" 
          id="register-email" 
          name="email"
          placeholder="your@email.com"
          autocomplete="email"
        >
      </div>

      <div class="form-group">
        <label for="register-password">密碼</label>
        <input 
          type="password" 
          id="register-password" 
          name="password"
          placeholder="至少 6 個字元"
          autocomplete="new-password"
        >
        <div class="password-strength">
          <div class="strength-bar">
            <div class="strength-fill" id="strengthFill"></div>
          </div>
        </div>
        <div class="requirements">
          <ul>
            <li id="req-length">至少 6 個字元</li>
            <li id="req-letter">包含英文字母</li>
            <li id="req-number">包含數字 (建議)</li>
          </ul>
        </div>
      </div>

      <div class="form-group">
        <label for="register-confirm">確認密碼</label>
        <input 
          type="password" 
          id="register-confirm" 
          name="confirm"
          placeholder="再次輸入密碼"
          autocomplete="new-password"
        >
      </div>

      <button type="button" id="register-btn" class="register-btn">
        註冊帳號
      </button>

      <div id="register-msg" class="register-msg"></div>
    </form>

    <div class="login-link">
      已有帳號？<a href="index.html">立即登入</a>
    </div>
  </div>
      </div>
      <!-- 個人資訊 -->
      <div id="profilePanel" class="panelCard" style="display:none">
        <div class="card">
          <h3>個人資訊</h3>
          <form id="profileForm" class="grid">
            <div>
              <label>姓名</label>
              <input id="name" />
            </div>
            <div>
              <label>生日</label>
              <input id="birthday" type="date" />
            </div>
            <div>
              <label>身高 (cm)</label>
              <input id="height" type="number" />
            </div>
            <div>
              <label>體重 (kg)</label>
              <input id="weight" type="number" />
            </div>
            <div>
              <label>運動種類</label>
              <select id="sportType">
                <option value="baseball">棒球</option>
                <option value="football">足球</option>
                <option value="general">綜合訓練</option>
              </select>
            </div>
            <div>
              <label>性別</label>
              <select id="gender">
                <option value="male">男</option>
                <option value="female">女</option>
                <option value="other">其他</option>
              </select>
            </div>
            <div class="full">
              <label>備註（過敏、特殊飲食）</label>
              <textarea id="notes"></textarea>
            </div>
            <div class="full row">
              <button id="saveProfile" type="button">儲存</button>
              <button id="loadProfile" type="button">載入</button>
            </div>
          </form>
        </div>
      </div>
      
      <!-- GOALS -->
      <div id="goalsPanel" class="panelCard" style="display:none">
        <div class="card">
          <h3>目標設定</h3>
          <label>短期目標</label>
          <input id="goalShort" />
          <label>長期目標</label>
          <input id="goalLong" />
          <div style="margin-top:10px">
            <button id="saveGoals" type="button">儲存目標</button>
          </div>
        </div>
      </div>

      <!-- DIET & CHARTS -->
      <div id="dietPanel" class="panelCard" style="display:none">
        <div class="card">
          <h3>飲食紀錄 & 建議</h3>
          <div style="display:flex;gap:12px">
            <div style="flex:1">
              <label>新增飲食紀錄（範例: 雞胸 150g）</label>
              <div class="row">
                <input id="foodName" placeholder="食物名稱" />
                <input id="foodGrams" type="number" placeholder="克數" class="small" />
                <button id="addLog" type="button">加入紀錄</button>
              </div>
              <div class="log-list" id="logs"></div>
            </div>
            <div style="width:480px">
              <label>建議圖表</label>
              <div class="chart-wrap">
                <div class="chart-box card"><canvas id="pieChart"></canvas></div>
                <div class="chart-box card"><canvas id="servingChart"></canvas></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- HABITS -->
      <div id="habitsPanel" class="panelCard" style="display:none">
        <div class="card">
          <h3>運動種類、頻率與時長</h3>
          <div class="grid">
            <div>
              <label>每週訓練次數</label>
              <input id="freqPerWeek" type="number" />
            </div>
            <div>
              <label>每次時長（分鐘）</label>
              <input id="durationMin" type="number" />
            </div>
            <div class="full">
              <label>飲食習慣（勾選）</label>
              <div class="row">
                <label><input type="checkbox" id="mealBreakfast"> 早餐</label>
                <label><input type="checkbox" id="mealLunch"> 午餐</label>
                <label><input type="checkbox" id="mealDinner"> 晚餐</label>
                <label><input type="checkbox" id="mealLate"> 宵夜</label>
              </div>
            </div>
            <div class="full row"><button id="saveHabits">儲存習慣</button></div>
          </div>
        </div>
      </div>

      <!-- QA -->
      <div id="qaPanel" class="panelCard" style="display:none">
        <div class="card">
          <h3>AI 問答</h3>
          <button id="clearHistoryBtn" onclick="clearChatHistory()" 
           style="padding: 8px 16px; background: #ff6b6b; color: white; border: none; border-radius: 6px; cursor: pointer;">
             🗑️ 清除歷史
          </button>
          <textarea id="qaInput" placeholder="輸入問題，例如：我明天投手比賽，該吃什麼？"></textarea>
          <button id="askBtn">送出給 AI</button>
          <h4>對話歷史</h4>
          <div id="qaResponse" class="muted" style="height:200px; overflow:auto; border:1px solid #ccc; padding:4px"></div>
        </div>
      </div>


      <!-- NUTRIENT SEARCH -->
      <div id="nutrientPanel" class="panelCard" style="display:none">
        <div class="card">
          <h3>營養素查詢（圖片 / 文字）</h3>
          <label>文字查詢</label>
          <div class="row">
            <input id="nutrientQuery" placeholder="例如：雞胸 肌酸 含量"/>
            <button id="nutrientSearch">查詢</button>
          </div>

          <label style="margin-top:10px">上傳食物圖片（後端須實作影像辨識 + RAG）</label>
          <div class="row">
            <input type="file" id="imgUpload" accept="image/*" />
            <button id="imgSearch">用圖片查詢</button>
          </div>
          <img id="imgPreview" class="img-preview" src="" />

          <h4>查詢結果</h4>
          <div id="nutrientResult" class="muted"></div>
        </div>
      </div>
      <!-- food table-->
      <div id="foodPanel" class="panelCard" style="display:none">
        <div class="card">
          <h3>食物輸入</h3>
            <form id="foodForm">
              <input placeholder="Name" id="foodname" required><br>
              <input placeholder="Portion size per day" id="portion"><br>
              <input placeholder="Cal/100g" id="cal" type="number" step="0.1"><br>
              <input placeholder="Carbon/100g" id="carbon" type="number" step="0.1"><br>
              <input placeholder="Protein/100g" id="protein" type="number" step="0.1"><br>
              <input placeholder="Fats/100g" id="fats" type="number" step="0.1"><br>
              <input placeholder="Flavor (sweet, sour...)" id="flavor"><br>
              <input placeholder="Category" id="category"><br>
              <textarea placeholder="Description" id="desc"></textarea><br>
              <button id="addFood" type="button">Add Food</button>
            </form>
            <div class="foodList" id="foods"></div>
            <div id="foodList"></div>
        </div>
      </div>
      <!-- recipe table-->
      <div id="recipePanel" class="panelCard" style="display:none">
        <div class="card">
            <div class="container">
                <!-- 標題區 -->
                  <div class="header-content">
                      <svg class="icon-chef" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z"/>
                          <line x1="6" y1="17" x2="18" y2="17"/>
                      </svg>
                      <div>
                          <h1>食譜營養分析系統</h1>
                          <p class="subtitle">輸入食譜，自動分析營養成分並儲存到資料庫</p>
                      </div>
                  </div>

                <!-- 分頁標籤 -->
                <div class="tabs">
                    <button class="tab-button active" data-tab="input">
                        <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z"/>
                        </svg>
                        輸入食譜
                    </button>
                    <button class="tab-button" data-tab="list">
                        <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="8" y1="6" x2="21" y2="6"/>
                            <line x1="8" y1="12" x2="21" y2="12"/>
                            <line x1="8" y1="18" x2="21" y2="18"/>
                            <line x1="3" y1="6" x2="3.01" y2="6"/>
                            <line x1="3" y1="12" x2="3.01" y2="12"/>
                            <line x1="3" y1="18" x2="3.01" y2="18"/>
                        </svg>
                        已儲存食譜 <span id="recipe-count">(0)</span>
                    </button>
                </div>

                <!-- 輸入食譜分頁 -->
                <div id="input-tab" class="tab-content active">
                    <div class="card">
                        <h2 class="card-title">📝 輸入食譜資訊</h2>
                        
                        <div class="form-group">
                            <label for="recipe-name">食譜名稱</label>
                            <input type="text" id="recipe-name" placeholder="例如：香煎雞胸肉佐時蔬">
                        </div>

                        <div class="form-group">
                            <label for="servings">份量</label>
                            <div class="servings-input">
                                <input type="number" id="servings" min="1" value="1">
                                <span>人份</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="recipe-content">食譜內容（包含食材與作法）</label>
                            <textarea id="recipe-content" rows="12" placeholder="請輸入食譜內容，例如：

食材：
雞胸肉 200克
橄欖油 1匙
花椰菜 100克
...

作法：
1. 雞胸肉醃製...
2. 熱鍋後..."></textarea>
                        </div>

                        <button id="analyze-btn" class="btn btn-primary">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                            </svg>
                            <span id="analyze-text">AI 分析營養成分</span>
                        </button>
                    </div>

                    <!-- 營養分析結果 -->
                    <div id="nutrition-result" class="card hidden">
                        <h2 class="card-title">🔬 營養成分分析</h2>
                        
                        <div class="nutrition-grid" id="nutrition-grid">
                            <!-- 營養數據會由 JS 動態生成 -->
                        </div>

                        <div id="ingredients-section" class="ingredients-section hidden">
                            <h3>識別的食材：</h3>
                            <div id="ingredients-list" class="ingredients-list"></div>
                        </div>

                        <button id="save-btn" class="btn btn-success">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                <polyline points="17 21 17 13 7 13 7 21"/>
                                <polyline points="7 3 7 8 15 8"/>
                            </svg>
                            儲存食譜到資料庫
                        </button>
                    </div>
                </div>

                <!-- 已儲存食譜分頁 -->
                <div id="list-tab" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <svg class="icon-database" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <ellipse cx="12" cy="5" rx="9" ry="3"/>
                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                            </svg>
                            <h2>資料庫中的食譜</h2>
                        </div>

                        <div id="recipes-list" class="recipes-list">
                            <div class="empty-state">
                                <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <ellipse cx="12" cy="5" rx="9" ry="3"/>
                                    <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                                    <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                                </svg>
                                <p>尚未儲存任何食譜</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 食譜詳情彈窗 -->
    <div id="recipe-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-recipe-name"></h2>
                <button id="close-modal" class="close-btn">✕</button>
            </div>
            
            <div id="modal-recipe-info" class="modal-info"></div>
            
            <div class="nutrition-grid" id="modal-nutrition-grid"></div>
            
            <div class="modal-section">
                <h3>食譜內容：</h3>
                <div id="modal-recipe-content" class="recipe-content"></div>
            </div>

            <div id="modal-ingredients-section" class="modal-section hidden">
                <h3>識別的食材：</h3>
                <div id="modal-ingredients-list" class="ingredients-list"></div>
            </div>
        </div>
    </div>
    </section>
  </div>
  <script src="script.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>

</body>
</html>
